# --------------------------------------------------------------------
# lupdate
# --------------------------------------------------------------------
IF( BUILDSYS_ENABLE_CREATE_TRANSLATIONS )
    SET( TS_FILES )
    SET( TS_QM_FILES )

    SET( TS_CREATE_OPTIONS )
    IF( BUILDSYS_NO_OBSOLETE_TRANSLATIONS )
        SET( TS_CREATE_OPTIONS ${TS_CREATE_OPTIONS} -no-obsolete )
    ENDIF( BUILDSYS_NO_OBSOLETE_TRANSLATIONS )

    FOREACH( TS_LANGUAGE ${BUILDSYS_TRANSLATIONS_LANGUAGES} )
        LIST( APPEND TS_FILES "${BUILDSYS_PRODUCT_DOMAIN}_${TS_LANGUAGE}.ts" )
    ENDFOREACH( TS_LANGUAGE ${BUILDSYS_TRANSLATIONS_LANGUAGES} )

	SET( BUILDSYS_INTL_CPP 
		"${BUILDSYS_SRC_DIR}/db/*.cpp" 
		"${BUILDSYS_SRC_DIR}/intl/*.cpp" 
		"${BUILDSYS_SRC_DIR}/pref/*.cpp" 
		"${BUILDSYS_SRC_DIR}/service/*.cpp" 
		"${BUILDSYS_SRC_DIR}/ui/*.cpp" 
		"${BUILDSYS_SRC_DIR}/up2date/*.cpp" 
		"${BUILDSYS_SRC_DIR}/utility/*.cpp" )
	SET( BUILDSYS_INTL_H 
		"${BUILDSYS_SRC_DIR}/db/*.h" 
		"${BUILDSYS_SRC_DIR}/intl/*.h" 
		"${BUILDSYS_SRC_DIR}/pref/*.h" 
		"${BUILDSYS_SRC_DIR}/service/*.h" 
		"${BUILDSYS_SRC_DIR}/ui/*.h" 
		"${BUILDSYS_SRC_DIR}/up2date/*.h" 
		"${BUILDSYS_SRC_DIR}/utility/*.h" )
	SET( BUILDSYS_INTL_UI 
		"${BUILDSYS_SRC_DIR}/db/*.ui" 
		"${BUILDSYS_SRC_DIR}/intl/*.ui" 
		"${BUILDSYS_SRC_DIR}/pref/*.ui" 
		"${BUILDSYS_SRC_DIR}/service/*.ui" 
		"${BUILDSYS_SRC_DIR}/ui/*.ui" 
		"${BUILDSYS_SRC_DIR}/up2date/*.ui" 
		"${BUILDSYS_SRC_DIR}/utility/*.ui" )
	SET( BUILDSYS_INTL_QML 
		"${BUILDSYS_SRC_DIR}/db/*.qml" 
		"${BUILDSYS_SRC_DIR}/intl/*.qml" 
		"${BUILDSYS_SRC_DIR}/pref/*.qml" 
		"${BUILDSYS_SRC_DIR}/service/*.qml" 
		"${BUILDSYS_SRC_DIR}/ui/*.qml" 
		"${BUILDSYS_SRC_DIR}/up2date/*.qml" 
		"${BUILDSYS_SRC_DIR}/utility/*.qml" )
IF( BUILDSYS_PACKAGE_PHONE )
	SET( BUILDSYS_INTL_CPP ${BUILDSYS_INTL_CPP} "${BUILDSYS_SRC_DIR}/phone/*.cpp")
	SET( BUILDSYS_INTL_H ${BUILDSYS_INTL_H} "${BUILDSYS_SRC_DIR}/phone/*.h")
	SET( BUILDSYS_INTL_UI ${BUILDSYS_INTL_UI} "${BUILDSYS_SRC_DIR}/phone/*.ui")
	SET( BUILDSYS_INTL_QML ${BUILDSYS_INTL_QML} "${BUILDSYS_SRC_DIR}/phone/*.qml")
ELSE( BUILDSYS_PACKAGE_PHONE )
	SET( BUILDSYS_INTL_CPP ${BUILDSYS_INTL_CPP} "${BUILDSYS_SRC_DIR}/translator/*.cpp")
	SET( BUILDSYS_INTL_H ${BUILDSYS_INTL_H} "${BUILDSYS_SRC_DIR}/translator/*.h")
	SET( BUILDSYS_INTL_UI ${BUILDSYS_INTL_UI} "${BUILDSYS_SRC_DIR}/translator/*.ui")
	SET( BUILDSYS_INTL_QML ${BUILDSYS_INTL_QML} "${BUILDSYS_SRC_DIR}/translator/*.qml")
ENDIF( BUILDSYS_PACKAGE_PHONE )

    FILE( GLOB_RECURSE TS_CPP_FILES ${BUILDSYS_INTL_CPP} )
    FILE( GLOB_RECURSE TS_H_FILES ${BUILDSYS_INTL_H} )
    FILE( GLOB_RECURSE TS_UI_FILES ${BUILDSYS_INTL_UI} )
    FILE( GLOB_RECURSE TS_QML_FILES ${BUILDSYS_INTL_QML} )
	
#    FILE( GLOB_RECURSE TS_CPP_FILES "${BUILDSYS_SRC_DIR}/*.cpp" )
#    FILE( GLOB_RECURSE TS_H_FILES "${BUILDSYS_SRC_DIR}/*.h" )
#    FILE( GLOB_RECURSE TS_UI_FILES "${BUILDSYS_SRC_DIR}/*.ui" )
#    FILE( GLOB_RECURSE TS_QML_FILES "${BUILDSYS_SRC_DIR}/*.qml" )
    SET( TS_SOURCE_FILES ${TS_CPP_FILES} ${TS_H_FILES} ${TS_UI_FILES} ${TS_QML_FILES} )
	
	QT4_CREATE_TRANSLATION( TS_QM_FILES ${TS_SOURCE_FILES} ${TS_FILES} OPTIONS ${TS_CREATE_OPTIONS} )

    ADD_CUSTOM_TARGET( lupdate DEPENDS ${TS_QM_FILES} )
ENDIF( BUILDSYS_ENABLE_CREATE_TRANSLATIONS )

# --------------------------------------------------------------------
# lrelease
# --------------------------------------------------------------------
SET( TS_REL_FILES )
SET( TS_REL_QM_FILES )

FOREACH( TS_LANGUAGE ${BUILDSYS_TRANSLATIONS_LANGUAGES} )
    LIST( APPEND TS_REL_FILES "${BUILDSYS_PRODUCT_DOMAIN}_${TS_LANGUAGE}.ts" )
ENDFOREACH( TS_LANGUAGE ${BUILDSYS_TRANSLATIONS_LANGUAGES} )

IF( BUILDSYS_TRANSLATIONS_INCLUDE_QT )
    FOREACH( TS_LANGUAGE ${BUILDSYS_TRANSLATIONS_LANGUAGES_QT} )
        SET( TS_QT_QM_FILENAME "qt_${TS_LANGUAGE}" )
        SET( TS_QT_QM_FILE "${QT_TRANSLATIONS_DIR}/${TS_QT_QM_FILENAME}.qm" )
        IF( EXISTS ${TS_QT_QM_FILE} )
            ADD_CUSTOM_COMMAND(
                OUTPUT "${TS_QT_QM_FILENAME}.qm"
                COMMAND ${CMAKE_COMMAND} -E copy_if_different ${TS_QT_QM_FILE} "${TS_QT_QM_FILENAME}.qm"
                VERBATIM
            )
            LIST( APPEND TS_REL_QM_FILES "${TS_QT_QM_FILENAME}.qm" )
        ELSE( EXISTS ${TS_QT_QM_FILE} )
            LIST( APPEND TS_REL_FILES "${QT_TRANSLATIONS_DIR}/${TS_QT_QM_FILENAME}.ts" )
        ENDIF( EXISTS ${TS_QT_QM_FILE} )
    ENDFOREACH( TS_LANGUAGE ${BUILDSYS_TRANSLATIONS_LANGUAGES_QT} )
ENDIF( BUILDSYS_TRANSLATIONS_INCLUDE_QT )

QT4_ADD_TRANSLATION( TS_REL_QM_FILES ${TS_REL_FILES} )

ADD_CUSTOM_TARGET( lrelease DEPENDS ${TS_REL_QM_FILES} )
